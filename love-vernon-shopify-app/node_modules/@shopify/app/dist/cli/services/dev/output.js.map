{"version":3,"file":"output.js","sourceRoot":"","sources":["../../../../src/cli/services/dev/output.ts"],"names":[],"mappings":"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","sourcesContent":["import {PartnersURLs} from './urls.js'\nimport {AppInterface} from '../../models/app/app.js'\nimport {FunctionExtension, ThemeExtension} from '../../models/app/extensions.js'\nimport {OrganizationApp} from '../../models/organization.js'\nimport {partnersFqdn} from '@shopify/cli-kit/node/context/fqdn'\nimport {renderConcurrent, RenderConcurrentOptions, renderInfo} from '@shopify/cli-kit/node/ui'\nimport {outputContent, outputInfo, outputToken} from '@shopify/cli-kit/node/output'\nimport {openURL} from '@shopify/cli-kit/node/system'\n\nexport async function outputUpdateURLsResult(\n  updated: boolean,\n  urls: PartnersURLs,\n  app: Omit<OrganizationApp, 'apiSecretKeys' | 'apiKey'> & {apiSecret?: string},\n) {\n  const dashboardURL = await partnersURL(app.organizationId, app.id)\n  if (app.newApp) {\n    renderInfo({\n      headline: `For your convenience, we've given your app a default URL: ${urls.applicationUrl}.`,\n      body: [\n        \"You can update your app's URL anytime in the\",\n        dashboardURL,\n        'But once your app is live, updating its URL will disrupt user access.',\n      ],\n    })\n  } else if (!updated) {\n    renderInfo({\n      body: [\n        'To make URL updates manually, you can add the following URLs as redirects in your',\n        dashboardURL,\n        {char: ':'},\n        '\\n\\n',\n        {list: {items: urls.redirectUrlWhitelist}},\n      ],\n    })\n  }\n}\n\nexport function outputExtensionsMessages(app: AppInterface) {\n  outputFunctionsMessage(app.extensions.function)\n  outputThemeExtensionsMessage(app.extensions.theme)\n}\n\nexport function renderDev(renderConcurrentOptions: RenderConcurrentOptions, previewUrl: string | undefined) {\n  let options = renderConcurrentOptions\n\n  if (previewUrl) {\n    options = {\n      ...options,\n      onInput: (input, _key, exit) => {\n        if (input === 'p' && previewUrl) {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          openURL(previewUrl)\n        } else if (input === 'q') {\n          exit()\n        }\n      },\n      footer: {\n        shortcuts: [\n          {\n            key: 'p',\n            action: 'preview in your browser',\n          },\n          {\n            key: 'q',\n            action: 'quit',\n          },\n        ],\n        subTitle: `Preview URL: ${previewUrl}`,\n      },\n    }\n  }\n  return renderConcurrent(options)\n}\n\nfunction outputFunctionsMessage(extensions: FunctionExtension[]) {\n  if (extensions.length === 0) return\n  const names = extensions.map((ext) => ext.configuration.name)\n  const heading = outputToken.heading(names.join(', '))\n  const message = `These extensions need to be deployed to be manually tested.\nOne testing option is to use a separate app dedicated to staging.`\n  outputInfo(outputContent`${heading}\\n${message}\\n`)\n}\n\nfunction outputThemeExtensionsMessage(extensions: ThemeExtension[]) {\n  if (extensions.length === 0) return\n  for (const extension of extensions) {\n    const message = extension.previewMessage('', '')\n    if (message) outputInfo(message)\n  }\n}\n\nasync function partnersURL(organizationId: string, appId: string) {\n  return {\n    link: {\n      label: 'Partners Dashboard',\n      url: `https://${await partnersFqdn()}/${organizationId}/apps/${appId}/edit`,\n    },\n  }\n}\n"]}